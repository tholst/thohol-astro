---
import BaseLayout from '../../layouts/BaseLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import { SITE_TITLE } from '../../consts';
import { getCollection } from 'astro:content';

const allTools = await getCollection('tools');
const tools = allTools
  .filter((tool) => tool.data.published !== false)
  .sort((a, b) => a.data.order - b.data.order);
---

<BaseLayout
  title={`Tools · ${SITE_TITLE}`}
  description="Interactive utilities for practical engineering work."
>
  <main>
    <section class="intro">
      <h1>Tools</h1>
      <p>Small interactive utilities for day-to-day engineering tasks.</p>
    </section>

    {
      tools.length === 0 ? (
        <p class="empty-tools">No tools published yet.</p>
      ) : (
        <ul class="tool-list" aria-label="Available tools">
          {tools.map((tool) => (
            <li>
              <h2>
                <a
                  href={`/tools/${tool.id}/`}
                  transition:name={'tool-title-' + tool.id}
                >
                  {tool.data.title}
                </a>
              </h2>
              <p>{tool.data.description}</p>
              <p class="updated-at">
                <span class="meta-icon" aria-hidden="true">
                  <svg
                    viewBox="0 0 24 24"
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M8 2v3M16 2v3" />
                    <path d="M3 9h18" />
                    <path d="M5 5h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" />
                  </svg>
                </span>
                <span class="sr-only">Created: </span>
                <FormattedDate
                  date={tool.data.createdAt ?? tool.data.updatedAt}
                />
                {tool.data.createdAt &&
                  tool.data.updatedAt.valueOf() !==
                    tool.data.createdAt.valueOf() && (
                    <>
                      <span aria-hidden="true">•</span>
                      <span class="meta-updated">
                        Updated <FormattedDate date={tool.data.updatedAt} />
                      </span>
                    </>
                  )}
              </p>
            </li>
          ))}
        </ul>
      )
    }
  </main>
</BaseLayout>

<style>
  .intro p {
    margin: 0;
    color: var(--ink-soft);
  }

  .tool-list {
    margin: 1rem 0 0;
    padding: 0;
    list-style: none;
    border-top: 1px solid var(--line);
  }

  .tool-list li {
    padding: 0.85rem 0;
    border-bottom: 1px solid var(--line);
  }

  .tool-list h2 {
    margin: 0 0 0.25rem;
    font-size: clamp(1.05rem, 2vw, 1.25rem);
  }

  .tool-list p {
    margin: 0;
    color: var(--ink-soft);
  }

  .tool-list .updated-at {
    margin-top: 0.3rem;
    font-family: var(--font-mono);
    font-size: 14px;
    line-height: 1.25;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .tool-list .meta-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--ink-soft);
    line-height: 0;
  }

  .tool-list .meta-icon svg {
    display: block;
    transform: translateY(-1px);
  }

  .tool-list .meta-updated time {
    font-size: inherit;
    line-height: inherit;
  }

  .empty-tools {
    margin-top: 1rem;
    color: var(--ink-soft);
  }
</style>
