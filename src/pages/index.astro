---
import BaseLayout from '../layouts/BaseLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { getCollection } from 'astro:content';
import { SITE_DESCRIPTION, SITE_TITLE, SOCIAL_LINKS } from '../consts';

const allPosts = await getCollection('blog');
const posts = (
  import.meta.env.PROD
    ? allPosts.filter((post) => post.data.published !== false)
    : allPosts
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const featured = posts.slice(0, 3);
const backlog = posts.slice(3, 9);
---

<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  <main>
    <section class="hero">
      <p class="kicker">Developer Blog</p>
      <h1>Notes from the workbench.</h1>
      <p class="summary">
        I write practical engineering notes about React, Docker, architecture,
        and the small implementation details that decide whether a system stays
        maintainable.
      </p>
      <ul class="hero-links">
        {
          SOCIAL_LINKS.map((link) => (
            <li>
              <a href={link.href}>{link.label}</a>
            </li>
          ))
        }
      </ul>
    </section>

    <section class="featured" aria-label="Featured posts">
      <header>
        <h2>Featured</h2>
        <a href="/blog/">Open archive</a>
      </header>

      <div class="feature-grid">
        {
          featured.map((post) => (
            <article class="feature-card">
              <p class="meta">
                <FormattedDate date={post.data.pubDate} />
              </p>
              <h3>
                <a href={`/blog/${post.id}/`}>{post.data.title}</a>
              </h3>
              <p>{post.data.description}</p>
            </article>
          ))
        }
      </div>
    </section>

    <section class="backlog" aria-label="Additional posts">
      <h2>Archive preview</h2>
      <ul>
        {
          backlog.map((post) => (
            <li>
              <time datetime={post.data.pubDate.toISOString()}>
                <FormattedDate date={post.data.pubDate} />
              </time>
              <a href={`/blog/${post.id}/`}>{post.data.title}</a>
            </li>
          ))
        }
      </ul>
    </section>
  </main>
</BaseLayout>

<style>
  .hero {
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: clamp(1rem, 2vw, 1.4rem);
    background: linear-gradient(
      180deg,
      color-mix(in srgb, var(--accent) 8%, white) 0%,
      var(--panel) 100%
    );
  }

  .kicker {
    margin: 0;
    font-family: var(--font-mono);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--ink-soft);
    font-size: 0.75rem;
  }

  .summary {
    max-width: 58ch;
  }

  .hero-links {
    list-style: none;
    display: flex;
    gap: 0.55rem;
    padding: 0;
    margin: 1.1rem 0 0;
    flex-wrap: wrap;
  }

  .hero-links a {
    display: inline-block;
    padding: 0.3rem 0.68rem;
    border: 1px solid var(--line);
    border-radius: 999px;
    text-decoration: none;
    color: var(--ink-soft);
  }

  .featured {
    margin-top: 1.3rem;
  }

  .featured header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    gap: 0.8rem;
    margin-bottom: 0.8rem;
  }

  .feature-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 0.8rem;
  }

  .feature-card {
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 0.9rem;
    background: var(--panel-soft);
    transition:
      transform 140ms ease,
      border-color 140ms ease,
      box-shadow 140ms ease;
  }

  .feature-card:hover {
    transform: translateY(-2px);
    border-color: color-mix(in srgb, var(--accent) 35%, var(--line));
    box-shadow: 0 12px 22px rgba(16, 24, 40, 0.08);
  }

  .feature-card h3 {
    margin-bottom: 0.55rem;
  }

  .meta {
    margin: 0;
    color: var(--ink-soft);
    font-size: 0.82rem;
    font-family: var(--font-mono);
  }

  .backlog {
    margin-top: 1.3rem;
  }

  .backlog ul {
    margin: 0;
    padding: 0;
    list-style: none;
    border-top: 1px solid var(--line);
  }

  .backlog li {
    display: grid;
    grid-template-columns: 154px 1fr;
    gap: 1rem;
    align-items: center;
    padding: 0.8rem 0.2rem;
    border-bottom: 1px solid var(--line);
  }

  .backlog time {
    color: var(--ink-soft);
    font-family: var(--font-mono);
    font-size: 0.82rem;
  }

  @media (max-width: 920px) {
    .feature-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 600px) {
    .backlog li {
      grid-template-columns: 1fr;
      gap: 0.35rem;
    }
  }
</style>
